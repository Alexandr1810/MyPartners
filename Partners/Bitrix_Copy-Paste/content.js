console.log("Copy/Paste скрипт работакет")

CardFounder_On = true
IframeCard_On = false
SiteCard_On = false
DealId = ''

CardFounderInterval = setInterval(CardFounder, 1000);
SiteCardInterval = setInterval(SiteCard, 1000);

var cityDecoder = {
    "534": "Адыгейск",
    "536": "Майкоп",
    "538": "Горно-Алтайск",
    "540": "Алейск",
    "542": "Барнаул",
    "544": "Белокуриха",
    "546": "Бийск",
    "548": "Горняк",
    "550": "Заринск",
    "552": "Змеиногорск",
    "554": "Камень-на-Оби",
    "556": "Новоалтайск",
    "558": "Рубцовск",
    "560": "Славгород",
    "562": "Яровое",
    "564": "Белогорск",
    "566": "Благовещенск",
    "568": "Завитинск",
    "570": "Зея",
    "572": "Райчихинск",
    "574": "Свободный",
    "576": "Сковородино",
    "578": "Тында",
    "580": "Шимановск",
    "582": "Архангельск",
    "584": "Вельск",
    "586": "Каргополь",
    "588": "Коряжма",
    "590": "Котлас",
    "592": "Мезень",
    "594": "Мирный",
    "596": "Новодвинск",
    "598": "Няндома",
    "600": "Онега",
    "602": "Северодвинск",
    "604": "Сольвычегодск",
    "606": "Шенкурск",
    "608": "Астрахань",
    "610": "Ахтубинск",
    "612": "Знаменск",
    "614": "Камызяк",
    "616": "Нариманов",
    "618": "Харабали",
    "620": "Агидель",
    "622": "Баймак",
    "624": "Белебей",
    "626": "Белорецк",
    "628": "Бирск",
    "630": "Давлеканово",
    "632": "Дюртюли",
    "634": "Ишимбай",
    "636": "Кумертау",
    "638": "Межгорье",
    "640": "Мелеуз",
    "642": "Нефтекамск",
    "644": "Октябрьский",
    "646": "Салават",
    "648": "Сибай",
    "650": "Стерлитамак",
    "652": "Туймазы",
    "654": "Уфа",
    "656": "Учалы",
    "658": "Янаул",
    "660": "Алексеевка",
    "662": "Белгород",
    "664": "Бирюч",
    "666": "Валуйки",
    "668": "Грайворон",
    "670": "Губкин",
    "672": "Короча",
    "674": "Новый Оскол",
    "676": "Старый Оскол",
    "678": "Строитель",
    "680": "Шебекино",
    "682": "Брянск",
    "684": "Дятьково",
    "686": "Жуковка",
    "688": "Злынка",
    "690": "Карачев",
    "692": "Клинцы",
    "694": "Мглин",
    "696": "Новозыбков",
    "698": "Почеп",
    "700": "Севск",
    "702": "Сельцо",
    "704": "Стародуб",
    "706": "Сураж",
    "708": "Трубчевск",
    "710": "Унеча",
    "712": "Фокино",
    "714": "Бабушкин",
    "716": "Гусиноозёрск",
    "718": "Закаменск",
    "720": "Кяхта",
    "722": "Северобайкальск",
    "724": "Улан-Удэ",
    "726": "Александров",
    "728": "Владимир",
    "730": "Вязники",
    "732": "Гороховец",
    "734": "Гусь-Хрустальный",
    "736": "Камешково",
    "738": "Карабаново",
    "740": "Киржач",
    "742": "Ковров",
    "744": "Кольчугино",
    "746": "Костерёво",
    "748": "Курлово",
    "750": "Лакинск",
    "752": "Меленки",
    "754": "Муром",
    "756": "Петушки",
    "758": "Покров",
    "760": "Радужный",
    "762": "Собинка",
    "764": "Струнино",
    "766": "Судогда",
    "768": "Суздаль",
    "770": "Юрьев-Польский",
    "772": "Волгоград",
    "774": "Волжский",
    "776": "Дубовка",
    "778": "Жирновск",
    "780": "Калач-на-Дону",
    "782": "Камышин",
    "784": "Котельниково",
    "786": "Котово",
    "788": "Краснослободск",
    "790": "Ленинск",
    "792": "Михайловка",
    "794": "Николаевск",
    "796": "Новоаннинский",
    "798": "Палласовка",
    "800": "Петров Вал",
    "802": "Серафимович",
    "804": "Суровикино",
    "806": "Урюпинск",
    "808": "Фролово",
    "810": "Бабаево",
    "812": "Белозерск",
    "814": "Великий Устюг",
    "816": "Вологда",
    "818": "Вытегра",
    "820": "Грязовец",
    "822": "Кадников",
    "824": "Кириллов",
    "826": "Красавино",
    "828": "Никольск",
    "830": "Сокол",
    "832": "Тотьма",
    "834": "Устюжна",
    "836": "Харовск",
    "838": "Череповец",
    "840": "Бобров",
    "842": "Богучар",
    "844": "Борисоглебск",
    "846": "Бутурлиновка",
    "848": "Воронеж",
    "850": "Калач",
    "852": "Лиски",
    "854": "Нововоронеж",
    "856": "Новохопёрск",
    "858": "Острогожск",
    "860": "Павловск",
    "862": "Поворино",
    "864": "Россошь",
    "866": "Семилуки",
    "868": "Эртиль",
    "870": "Буйнакск",
    "872": "Дагестанские Огни",
    "874": "Дербент",
    "876": "Избербаш",
    "878": "Каспийск",
    "880": "Кизилюрт",
    "882": "Кизляр",
    "884": "Махачкала",
    "886": "Хасавюрт",
    "888": "Южно-Сухокумск",
    "890": "Биробиджан",
    "892": "Облучье",
    "894": "Балей",
    "896": "Борзя",
    "898": "Краснокаменск",
    "900": "Могоча",
    "902": "Нерчинск",
    "904": "Петровск-Забайкальский",
    "906": "Сретенск",
    "908": "Хилок",
    "910": "Чита",
    "912": "Шилка",
    "914": "Вичуга",
    "916": "Гаврилов Посад",
    "918": "Заволжск",
    "920": "Иваново",
    "922": "Кинешма",
    "924": "Комсомольск",
    "926": "Кохма",
    "928": "Наволоки",
    "930": "Плёс",
    "932": "Приволжск",
    "934": "Пучеж",
    "936": "Родники",
    "938": "Тейково",
    "940": "Фурманов",
    "942": "Шуя",
    "944": "Южа",
    "946": "Юрьевец",
    "948": "Карабулак",
    "950": "Магас",
    "952": "Малгобек",
    "954": "Назрань",
    "956": "Алзамай",
    "958": "Ангарск",
    "960": "Байкальск",
    "962": "Бирюсинск",
    "964": "Бодайбо",
    "966": "Братск",
    "968": "Вихоревка",
    "972": "Зима",
    "974": "Иркутск",
    "976": "Киренск",
    "978": "Нижнеудинск",
    "980": "Саянск",
    "982": "Свирск",
    "984": "Слюдянка",
    "986": "Тайшет",
    "988": "Тулун",
    "990": "Усолье-Сибирское",
    "992": "Усть-Илимск",
    "994": "Усть-Кут",
    "996": "Черемхово",
    "998": "Шелехов",
    "1000": "Баксан",
    "1002": "Майский",
    "1004": "Нальчик",
    "1006": "Нарткала",
    "1008": "Прохладный",
    "1010": "Терек",
    "1012": "Тырныауз",
    "1014": "Чегем",
    "1016": "Багратионовск",
    "1018": "Балтийск",
    "1020": "Гвардейск",
    "1022": "Гурьевск",
    "1024": "Гусев",
    "1026": "Зеленоградск",
    "1028": "Калининград",
    "1030": "Краснознаменск",
    "1032": "Ладушкин",
    "1034": "Мамоново",
    "1036": "Неман",
    "1038": "Нестеров",
    "1040": "Озёрск",
    "1042": "Пионерский",
    "1044": "Полесск",
    "1046": "Правдинск",
    "1048": "Светлогорск",
    "1050": "Светлый",
    "1052": "Славск",
    "1054": "Советск",
    "1056": "Черняховск",
    "1058": "Приморск",
    "1060": "Городовиковск",
    "1062": "Лагань",
    "1064": "Элиста",
    "1066": "Балабаново",
    "1068": "Белоусово",
    "1070": "Боровск",
    "1072": "Ермолино",
    "1074": "Жиздра",
    "1076": "Жуков",
    "1078": "Калуга",
    "1080": "Киров",
    "1082": "Козельск",
    "1084": "Кондрово",
    "1086": "Кремёнки",
    "1088": "Людиново",
    "1090": "Малоярославец",
    "1092": "Медынь",
    "1094": "Мещовск",
    "1096": "Мосальск",
    "1098": "Обнинск",
    "1100": "Сосенский",
    "1102": "Спас-Деменск",
    "1104": "Сухиничи",
    "1106": "Таруса",
    "1108": "Юхнов",
    "1110": "Вилючинск",
    "1112": "Елизово",
    "1114": "Петропавловск-Камчатский",
    "1116": "Карачаевск",
    "1118": "Теберда",
    "1120": "Усть-Джегута",
    "1122": "Черкесск",
    "1124": "Беломорск",
    "1126": "Кемь",
    "1128": "Кондопога",
    "1130": "Костомукша",
    "1132": "Лахденпохья",
    "1134": "Медвежьегорск",
    "1136": "Олонец",
    "1138": "Петрозаводск",
    "1140": "Питкяранта",
    "1142": "Пудож",
    "1144": "Сегежа",
    "1146": "Сортавала",
    "1148": "Суоярви",
    "1150": "Анжеро-Судженск",
    "1152": "Белово",
    "1154": "Берёзовский",
    "1156": "Калтан",
    "1158": "Кемерово",
    "1160": "Киселёвск",
    "1162": "Ленинск-Кузнецкий",
    "1164": "Мариинск",
    "1166": "Междуреченск",
    "1168": "Мыски",
    "1170": "Новокузнецк",
    "1172": "Осинники",
    "1174": "Полысаево",
    "1176": "Прокопьевск",
    "1178": "Салаир",
    "1180": "Тайга",
    "1182": "Таштагол",
    "1184": "Топки",
    "1186": "Юрга",
    "1188": "Белая Холуница",
    "1190": "Вятские Поляны",
    "1192": "Зуевка",
    "1194": "Кирово-Чепецк",
    "1196": "Кирс",
    "1198": "Котельнич",
    "1200": "Луза",
    "1202": "Малмыж",
    "1204": "Мураши",
    "1206": "Нолинск",
    "1208": "Омутнинск",
    "1210": "Орлов",
    "1212": "Слободской",
    "1214": "Сосновка",
    "1216": "Уржум",
    "1218": "Яранск",
    "1220": "Воркута",
    "1222": "Вуктыл",
    "1224": "Емва",
    "1226": "Инта",
    "1228": "Микунь",
    "1230": "Печора",
    "1232": "Сосногорск",
    "1234": "Сыктывкар",
    "1236": "Усинск",
    "1238": "Ухта",
    "1240": "Буй",
    "1242": "Волгореченск",
    "1244": "Галич",
    "1246": "Кологрив",
    "1248": "Кострома",
    "1250": "Макарьев",
    "1252": "Мантурово",
    "1254": "Нерехта",
    "1256": "Нея",
    "1258": "Солигалич",
    "1260": "Чухлома",
    "1262": "Шарья",
    "1264": "Абинск",
    "1266": "Анапа",
    "1268": "Апшеронск",
    "1270": "Армавир",
    "1272": "Белореченск",
    "1274": "Геленджик",
    "1276": "Горячий Ключ",
    "1278": "Гулькевичи",
    "1280": "Ейск",
    "1282": "Кореновск",
    "1284": "Краснодар",
    "1286": "Кропоткин",
    "1288": "Крымск",
    "1292": "Лабинск",
    "1294": "Новокубанск",
    "1296": "Новороссийск",
    "1298": "Приморско-Ахтарск",
    "1300": "Славянск-на-Кубани",
    "1302": "Сочи",
    "1304": "Темрюк",
    "1306": "Тимашёвск",
    "1308": "Тихорецк",
    "1310": "Туапсе",
    "1312": "Усть-Лабинск",
    "1314": "Хадыженск",
    "1316": "Артёмовск",
    "1318": "Ачинск",
    "1320": "Боготол",
    "1322": "Бородино",
    "1324": "Дивногорск",
    "1326": "Дудинка",
    "1328": "Енисейск",
    "1330": "Железногорск",
    "1332": "Заозёрный",
    "1334": "Зеленогорск",
    "1336": "Игарка",
    "1338": "Иланский",
    "1340": "Канск",
    "1342": "Кодинск",
    "1344": "Красноярск",
    "1346": "Лесосибирск",
    "1348": "Минусинск",
    "1350": "Назарово",
    "1352": "Норильск",
    "1354": "Сосновоборск",
    "1356": "Ужур",
    "1358": "Уяр",
    "1360": "Шарыпово",
    "1362": "Далматово",
    "1364": "Катайск",
    "1366": "Курган",
    "1368": "Куртамыш",
    "1370": "Макушино",
    "1372": "Петухово",
    "1374": "Шадринск",
    "1376": "Шумиха",
    "1378": "Щучье",
    "1380": "Дмитриев",
    "1382": "Курск",
    "1384": "Курчатов",
    "1386": "Льгов",
    "1388": "Обоянь",
    "1390": "Рыльск",
    "1392": "Суджа",
    "1394": "Фатеж",
    "1396": "Щигры",
    "1398": "Бокситогорск",
    "1400": "Волосово",
    "1402": "Волхов",
    "1404": "Всеволожск",
    "1406": "Выборг",
    "1408": "Высоцк",
    "1410": "Гатчина",
    "1412": "Ивангород",
    "1414": "Каменногорск",
    "1416": "Кингисепп",
    "1418": "Кириши",
    "1420": "Кировск",
    "1422": "Коммунар",
    "1424": "Лодейное Поле",
    "1426": "Луга",
    "1428": "Любань",
    "1430": "Никольское",
    "1432": "Новая Ладога",
    "1434": "Отрадное",
    "1436": "Пикалёво",
    "1438": "Подпорожье",
    "1440": "Приозерск",
    "1442": "Светогорск",
    "1444": "Сертолово",
    "1446": "Сланцы",
    "1448": "Сосновый Бор",
    "1450": "Сясьстрой",
    "1452": "Тихвин",
    "1454": "Тосно",
    "1456": "Шлиссельбург",
    "1458": "Грязи",
    "1460": "Данков",
    "1462": "Елец",
    "1464": "Задонск",
    "1466": "Лебедянь",
    "1468": "Липецк",
    "1470": "Усмань",
    "1472": "Чаплыгин",
    "1474": "Магадан",
    "1476": "Сусуман",
    "1478": "Волжск",
    "1480": "Звенигово",
    "1482": "Йошкар-Ола",
    "1484": "Козьмодемьянск",
    "1486": "Ардатов",
    "1488": "Инсар",
    "1490": "Ковылкино",
    "1492": "Рузаевка",
    "1494": "Саранск",
    "1496": "Темников",
    "1498": "Москва",
    "1500": "Апрелевка",
    "1502": "Балашиха",
    "1504": "Бронницы",
    "1506": "Верея",
    "1508": "Видное",
    "1510": "Волоколамск",
    "1512": "Воскресенск",
    "1514": "Высоковск",
    "1516": "Голицыно",
    "1518": "Дедовск",
    "1520": "Дзержинский",
    "1522": "Дмитров",
    "1524": "Долгопрудный",
    "1526": "Домодедово",
    "1528": "Дрезна",
    "1530": "Дубна",
    "1532": "Егорьевск",
    "1534": "Железнодорожный",
    "1536": "Жуковский",
    "1538": "Зарайск",
    "1540": "Звенигород",
    "1542": "Ивантеевка",
    "1544": "Истра",
    "1546": "Кашира",
    "1548": "Климовск",
    "1550": "Клин",
    "1552": "Коломна",
    "1554": "Котельники",
    "1556": "Королёв",
    "1558": "Красноармейск",
    "1560": "Красногорск",
    "1562": "Краснозаводск",
    "1564": "Кубинка",
    "1566": "Куровское",
    "1568": "Ликино-Дулёво",
    "1570": "Лобня",
    "1572": "Лосино-Петровский",
    "1574": "Луховицы",
    "1576": "Лыткарино",
    "1578": "Люберцы",
    "1580": "Можайск",
    "1582": "Московский",
    "1584": "Мытищи",
    "1586": "Наро-Фоминск",
    "1588": "Ногинск",
    "1590": "Одинцово",
    "1592": "Ожерелье",
    "1594": "Озёры",
    "1596": "Орехово-Зуево",
    "1598": "Павловский Посад",
    "1600": "Пересвет",
    "1602": "Подольск",
    "1604": "Протвино",
    "1606": "Пушкино",
    "1608": "Пущино",
    "1610": "Раменское",
    "1612": "Реутов",
    "1614": "Рошаль",
    "1616": "Руза",
    "1618": "Сергиев Посад",
    "1620": "Серпухов",
    "1622": "Солнечногорск",
    "1624": "Старая Купавна",
    "1626": "Ступино",
    "1628": "Талдом",
    "1630": "Троицк",
    "1632": "Фрязино",
    "1634": "Химки",
    "1636": "Хотьково",
    "1638": "Черноголовка",
    "1640": "Чехов",
    "1642": "Шатура",
    "1644": "Щёлково",
    "1646": "Щербинка",
    "1648": "Электрогорск",
    "1650": "Электросталь",
    "1652": "Электроугли",
    "1654": "Юбилейный",
    "1656": "Яхрома",
    "1658": "Апатиты",
    "1660": "Гаджиево",
    "1662": "Заозёрск",
    "1664": "Заполярный",
    "1666": "Кандалакша",
    "1668": "Ковдор",
    "1670": "Кола",
    "1672": "Мончегорск",
    "1674": "Мурманск",
    "1676": "Оленегорск",
    "1678": "Островной",
    "1680": "Полярные Зори",
    "1682": "Полярный",
    "1684": "Североморск",
    "1686": "Снежногорск",
    "1688": "Нарьян-Мар",
    "1690": "Арзамас",
    "1692": "Балахна",
    "1694": "Богородск",
    "1696": "Бор",
    "1698": "Ветлуга",
    "1700": "Володарск",
    "1702": "Ворсма",
    "1704": "Выкса",
    "1706": "Горбатов",
    "1708": "Городец",
    "1710": "Дзержинск",
    "1712": "Заволжье",
    "1714": "Княгинино",
    "1716": "Кстово",
    "1718": "Кулебаки",
    "1720": "Лукоянов",
    "1722": "Лысково",
    "1724": "Навашино",
    "1726": "Нижний Новгород",
    "1728": "Павлово",
    "1730": "Первомайск",
    "1732": "Перевоз",
    "1734": "Саров",
    "1736": "Семёнов",
    "1738": "Сергач",
    "1740": "Урень",
    "1742": "Чкаловск",
    "1744": "Шахунья",
    "1746": "Боровичи",
    "1748": "Валдай",
    "1750": "Великий Новгород",
    "1752": "Малая Вишера",
    "1754": "Окуловка",
    "1756": "Пестово",
    "1758": "Сольцы",
    "1760": "Старая Русса",
    "1762": "Холм",
    "1764": "Чудово",
    "1766": "Барабинск",
    "1768": "Бердск",
    "1770": "Болотное",
    "1772": "Искитим",
    "1774": "Карасук",
    "1776": "Каргат",
    "1778": "Куйбышев",
    "1780": "Купино",
    "1782": "Новосибирск",
    "1784": "Обь",
    "1786": "Татарск",
    "1788": "Тогучин",
    "1790": "Черепаново",
    "1792": "Чулым",
    "1794": "Исилькуль",
    "1796": "Калачинск",
    "1798": "Называевск",
    "1800": "Омск",
    "1802": "Тара",
    "1804": "Тюкалинск",
    "1806": "Абдулино",
    "1808": "Бугуруслан",
    "1810": "Бузулук",
    "1812": "Гай",
    "1814": "Кувандык",
    "1816": "Медногорск",
    "1818": "Новотроицк",
    "1820": "Оренбург",
    "1822": "Орск",
    "1824": "Соль-Илецк",
    "1826": "Сорочинск",
    "1828": "Ясный",
    "1830": "Болхов",
    "1832": "Дмитровск",
    "1834": "Ливны",
    "1836": "Малоархангельск",
    "1838": "Мценск",
    "1840": "Новосиль",
    "1842": "Орёл",
    "1844": "Белинский",
    "1846": "Городище",
    "1848": "Заречный",
    "1850": "Каменка",
    "1852": "Кузнецк",
    "1854": "Нижний Ломов",
    "1856": "Пенза",
    "1858": "Сердобск",
    "1860": "Спасск",
    "1862": "Сурск",
    "1864": "Александровск",
    "1866": "Березники",
    "1868": "Верещагино",
    "1870": "Горнозаводск",
    "1872": "Гремячинск",
    "1874": "Губаха",
    "1876": "Добрянка",
    "1878": "Кизел",
    "1880": "Красновишерск",
    "1882": "Краснокамск",
    "1884": "Кудымкар",
    "1886": "Кунгур",
    "1888": "Лысьва",
    "1890": "Нытва",
    "1892": "Оса",
    "1894": "Оханск",
    "1896": "Очёр",
    "1898": "Пермь",
    "1900": "Соликамск",
    "1902": "Усолье",
    "1904": "Чайковский",
    "1906": "Чердынь",
    "1908": "Чёрмоз",
    "1910": "Чернушка",
    "1912": "Чусовой",
    "1914": "Арсеньев",
    "1916": "Артём",
    "1918": "Большой Камень",
    "1920": "Владивосток",
    "1922": "Дальнегорск",
    "1924": "Дальнереченск",
    "1926": "Лесозаводск",
    "1928": "Находка",
    "1930": "Партизанск",
    "1932": "Спасск-Дальний",
    "1934": "Уссурийск",
    "1936": "Великие Луки",
    "1938": "Гдов",
    "1940": "Дно",
    "1942": "Невель",
    "1944": "Новоржев",
    "1946": "Новосокольники",
    "1948": "Опочка",
    "1950": "Остров",
    "1952": "Печоры",
    "1954": "Порхов",
    "1956": "Псков",
    "1958": "Пустошка",
    "1960": "Пыталово",
    "1962": "Себеж",
    "1964": "Азов",
    "1966": "Аксай",
    "1968": "Батайск",
    "1970": "Белая Калитва",
    "1972": "Волгодонск",
    "1974": "Гуково",
    "1976": "Донецк",
    "1978": "Зверево",
    "1980": "Зерноград",
    "1982": "Каменск-Шахтинский",
    "1984": "Константиновск",
    "1986": "Красный Сулин",
    "1988": "Миллерово",
    "1990": "Морозовск",
    "1992": "Новочеркасск",
    "1994": "Новошахтинск",
    "1996": "Пролетарск",
    "1998": "Ростов-на-Дону",
    "2000": "Сальск",
    "2002": "Семикаракорск",
    "2004": "Таганрог",
    "2006": "Цимлянск",
    "2008": "Шахты",
    "2010": "Касимов",
    "2012": "Кораблино",
    "2014": "Михайлов",
    "2016": "Новомичуринск",
    "2018": "Рыбное",
    "2020": "Ряжск",
    "2022": "Рязань",
    "2024": "Сасово",
    "2026": "Скопин",
    "2028": "Спас-Клепики",
    "2030": "Спасск-Рязанский",
    "2032": "Шацк",
    "2034": "Жигулёвск",
    "2036": "Кинель",
    "2038": "Нефтегорск",
    "2040": "Новокуйбышевск",
    "2042": "Октябрьск",
    "2044": "Отрадный",
    "2046": "Похвистнево",
    "2048": "Самара",
    "2050": "Сызрань",
    "2052": "Тольятти",
    "2054": "Чапаевск",
    "2056": "Колпино",
    "2058": "Красное Село",
    "2060": "Кронштадт",
    "2062": "Ломоносов",
    "2064": "Петергоф",
    "2066": "Пушкин",
    "2068": "Санкт-Петербург",
    "2070": "Сестрорецк",
    "2072": "Аркадак",
    "2074": "Аткарск",
    "2076": "Балаково",
    "2078": "Балашов",
    "2080": "Вольск",
    "2082": "Ершов",
    "2084": "Калининск",
    "2086": "Красный Кут",
    "2088": "Маркс",
    "2090": "Новоузенск",
    "2092": "Петровск",
    "2094": "Пугачёв",
    "2096": "Ртищево",
    "2098": "Саратов",
    "2100": "Хвалынск",
    "2102": "Шиханы",
    "2104": "Энгельс",
    "2106": "Александровск-Сахалинский",
    "2108": "Анива",
    "2110": "Долинск",
    "2112": "Корсаков",
    "2114": "Курильск",
    "2116": "Макаров",
    "2118": "Невельск",
    "2120": "Оха",
    "2122": "Поронайск",
    "2124": "Северо-Курильск",
    "2126": "Томари",
    "2128": "Углегорск",
    "2130": "Холмск",
    "2132": "Шахтёрск",
    "2134": "Южно-Сахалинск",
    "2136": "Алапаевск",
    "2138": "Арамиль",
    "2140": "Артёмовский",
    "2142": "Асбест",
    "2144": "Богданович",
    "2146": "Верхний Тагил",
    "2148": "Верхняя Пышма",
    "2150": "Верхняя Салда",
    "2152": "Верхняя Тура",
    "2154": "Верхотурье",
    "2156": "Волчанск",
    "2158": "Дегтярск",
    "2160": "Екатеринбург",
    "2162": "Ивдель",
    "2164": "Ирбит",
    "2166": "Каменск-Уральский",
    "2168": "Камышлов",
    "2170": "Карпинск",
    "2172": "Качканар",
    "2174": "Кировград",
    "2176": "Краснотурьинск",
    "2178": "Красноуральск",
    "2180": "Красноуфимск",
    "2182": "Кушва",
    "2184": "Лесной",
    "2186": "Михайловск",
    "2188": "Невьянск",
    "2190": "Нижние Серги",
    "2192": "Нижний Тагил",
    "2194": "Нижняя Салда",
    "2196": "Нижняя Тура",
    "2198": "Новая Ляля",
    "2200": "Новоуральск",
    "2202": "Первоуральск",
    "2204": "Полевской",
    "2206": "Ревда",
    "2208": "Реж",
    "2210": "Североуральск",
    "2212": "Серов",
    "2214": "Среднеуральск",
    "2216": "Сухой Лог",
    "2218": "Сысерть",
    "2220": "Тавда",
    "2222": "Талица",
    "2224": "Туринск",
    "2226": "Алагир",
    "2228": "Ардон",
    "2230": "Беслан",
    "2232": "Владикавказ",
    "2234": "Дигора",
    "2236": "Моздок",
    "2238": "Велиж",
    "2240": "Вязьма",
    "2242": "Гагарин",
    "2244": "Демидов",
    "2246": "Десногорск",
    "2248": "Дорогобуж",
    "2250": "Духовщина",
    "2252": "Ельня",
    "2254": "Починок",
    "2256": "Рославль",
    "2258": "Рудня",
    "2260": "Сафоново",
    "2262": "Смоленск",
    "2264": "Сычёвка",
    "2266": "Ярцево",
    "2268": "Благодарный",
    "2270": "Будённовск",
    "2272": "Георгиевск",
    "2274": "Ессентуки",
    "2276": "Железноводск",
    "2278": "Зеленокумск",
    "2280": "Изобильный",
    "2282": "Ипатово",
    "2284": "Кисловодск",
    "2286": "Лермонтов",
    "2288": "Минеральные Воды",
    "2290": "Невинномысск",
    "2292": "Нефтекумск",
    "2294": "Новоалександровск",
    "2296": "Новопавловск",
    "2298": "Пятигорск",
    "2300": "Светлоград",
    "2302": "Ставрополь",
    "2304": "Жердевка",
    "2306": "Кирсанов",
    "2308": "Котовск",
    "2310": "Мичуринск",
    "2312": "Моршанск",
    "2314": "Рассказово",
    "2316": "Тамбов",
    "2318": "Уварово",
    "2320": "Агрыз",
    "2322": "Азнакаево",
    "2324": "Альметьевск",
    "2326": "Арск",
    "2328": "Бавлы",
    "2330": "Болгар",
    "2332": "Бугульма",
    "2334": "Буинск",
    "2336": "Елабуга",
    "2338": "Заинск",
    "2340": "Зеленодольск",
    "2342": "Казань",
    "2344": "Лаишево",
    "2346": "Лениногорск",
    "2348": "Мамадыш",
    "2350": "Менделеевск",
    "2352": "Мензелинск",
    "2354": "Набережные Челны",
    "2356": "Нижнекамск",
    "2358": "Нурлат",
    "2360": "Тетюши",
    "2362": "Чистополь",
    "2364": "Андреаполь",
    "2366": "Бежецк",
    "2368": "Белый",
    "2370": "Бологое",
    "2372": "Весьегонск",
    "2374": "Вышний Волочёк",
    "2376": "Западная Двина",
    "2378": "Зубцов",
    "2380": "Калязин",
    "2382": "Кашин",
    "2384": "Кимры",
    "2386": "Конаково",
    "2388": "Красный Холм",
    "2390": "Кувшиново",
    "2392": "Лихославль",
    "2394": "Нелидово",
    "2396": "Осташков",
    "2398": "Ржев",
    "2400": "Старица",
    "2402": "Тверь",
    "2404": "Торжок",
    "2406": "Торопец",
    "2408": "Удомля",
    "2410": "Асино",
    "2412": "Кедровый",
    "2414": "Колпашево",
    "2416": "Северск",
    "2418": "Стрежевой",
    "2420": "Томск",
    "2422": "Алексин",
    "2424": "Белёв",
    "2426": "Богородицк",
    "2428": "Болохово",
    "2430": "Венёв",
    "2432": "Донской",
    "2434": "Ефремов",
    "2436": "Кимовск",
    "2438": "Киреевск",
    "2440": "Липки",
    "2442": "Новомосковск",
    "2444": "Плавск",
    "2446": "Суворов",
    "2448": "Тула",
    "2450": "Узловая",
    "2452": "Чекалин",
    "2454": "Щёкино",
    "2456": "Ясногорск",
    "2458": "Ак-Довурак",
    "2460": "Кызыл",
    "2462": "Туран",
    "2464": "Чадан",
    "2466": "Шагонар",
    "2468": "Заводоуковск",
    "2470": "Ишим",
    "2472": "Тобольск",
    "2474": "Тюмень",
    "2476": "Ялуторовск",
    "2478": "Воткинск",
    "2480": "Глазов",
    "2482": "Ижевск",
    "2484": "Камбарка",
    "2486": "Можга",
    "2488": "Сарапул",
    "2490": "Барыш",
    "2492": "Димитровград",
    "2494": "Инза",
    "2496": "Новоульяновск",
    "2498": "Сенгилей",
    "2500": "Ульяновск",
    "2502": "Амурск",
    "2504": "Бикин",
    "2506": "Вяземский",
    "2508": "Комсомольск-на-Амуре",
    "2510": "Николаевск-на-Амуре",
    "2512": "Советская Гавань",
    "2514": "Хабаровск",
    "2516": "Абаза",
    "2518": "Абакан",
    "2520": "Саяногорск",
    "2522": "Сорск",
    "2524": "Черногорск",
    "2526": "Белоярский",
    "2528": "Когалым",
    "2530": "Лангепас",
    "2532": "Лянтор",
    "2534": "Мегион",
    "2536": "Нефтеюганск",
    "2538": "Нижневартовск",
    "2540": "Нягань",
    "2542": "Покачи",
    "2544": "Пыть-Ях",
    "2546": "Советский",
    "2548": "Сургут",
    "2550": "Урай",
    "2552": "Ханты-Мансийск",
    "2554": "Югорск",
    "2556": "Аша",
    "2558": "Бакал",
    "2560": "Верхнеуральск",
    "2562": "Верхний Уфалей",
    "2564": "Еманжелинск",
    "2566": "Златоуст",
    "2568": "Карабаш",
    "2570": "Карталы",
    "2572": "Касли",
    "2574": "Катав-Ивановск",
    "2576": "Копейск",
    "2578": "Коркино",
    "2580": "Куса",
    "2582": "Кыштым",
    "2584": "Магнитогорск",
    "2586": "Миасс",
    "2588": "Миньяр",
    "2590": "Нязепетровск",
    "2592": "Пласт",
    "2594": "Сатка",
    "2596": "Сим",
    "2598": "Снежинск",
    "2600": "Трёхгорный",
    "2602": "Усть-Катав",
    "2604": "Чебаркуль",
    "2606": "Челябинск",
    "2608": "Южноуральск",
    "2610": "Юрюзань",
    "2612": "Аргун",
    "2614": "Грозный",
    "2616": "Гудермес",
    "2618": "Урус-Мартан",
    "2620": "Шали",
    "2622": "Алатырь",
    "2624": "Канаш",
    "2626": "Козловка",
    "2628": "Мариинский Посад",
    "2630": "Новочебоксарск",
    "2632": "Цивильск",
    "2634": "Чебоксары",
    "2636": "Шумерля",
    "2638": "Ядрин",
    "2640": "Анадырь",
    "2642": "Билибино",
    "2644": "Певек",
    "2646": "Алдан",
    "2648": "Верхоянск",
    "2650": "Вилюйск",
    "2652": "Ленск",
    "2654": "Нерюнгри",
    "2656": "Нюрба",
    "2658": "Олёкминск",
    "2660": "Покровск",
    "2662": "Среднеколымск",
    "2664": "Томмот",
    "2666": "Удачный",
    "2668": "Якутск",
    "2670": "Губкинский",
    "2672": "Лабытнанги",
    "2674": "Муравленко",
    "2676": "Надым",
    "2678": "Новый Уренгой",
    "2680": "Ноябрьск",
    "2682": "Салехард",
    "2684": "Тарко-Сале",
    "2686": "Гаврилов-Ям",
    "2688": "Данилов",
    "2690": "Любим",
    "2692": "Мышкин",
    "2694": "Переславль-Залесский",
    "2696": "Пошехонье",
    "2698": "Ростов",
    "2700": "Рыбинск",
    "2702": "Тутаев",
    "2704": "Углич",
    "2706": "Ярославль"
}
var providerDecoder = {
    "66": "Ростелеком (Сибирь)",
    "5430": "Ростелеком (Северо-Запад)",
    "68": "Ростелеком Юр. Лица (Сибирь)",
    "5400": "Ростелеком (Дальний Восток)",
    "5546": "Ростелеком (Урал NEW)",
    "5402": "Ростелеком (Волга)",
    "5456": "Ростелеком (Москва)",
    "5578": "Ростелеком (Юг)",
    "5700": "Ростелеком (Центр)",
    "5526": "Ростелеком (Альфанет)",
    "5444": "Билайн (Россия)",
    "5448": "Билайн (Москва)",
    "78": "МТС (Россия)",
    "5580": "МТС2",
    "86": "Домру (Россия)",
    "5466": "Домру (Юрики)",
    "5442": "Домру (Улан-Удэ)",
    "5524": "ТТК (Россия)",
    "5460": "СибСети (Россия)",
    "5554": "Норком",
    "5436": "Орион (Красноярск2)",
    "108": "Орион (Иркутск)",
    "110": "Орион (Абакан)",
    "112": "Орион (Минусинск)",
    "114": "Орион (Братск)",
    "116": "Орион (Зеленогорск)",
    "118": "Орион (Железногорск)",
    "120": "Орион (Канск)",
    "122": "Орион (Черногорск)",
    "5736": "Бизнес-телеком",
    "5474": "Мегафон",
    "128": "Телекома Right Side",
    "124": "Игра Сервис (Красноярск)",
    "130": "Аксиома",
    "132": "Омские Кабельные Сети",
    "134": "Электронный город",
    "5476": "Электронный город (Юрики)",
    "138": "Планета",
    "140": "Инсис",
    "142": "К-Телеком",
    "5548": "Север Русская компания",
    "5550": "Юг Русская компания",
    "146": "АБВ",
    "5302": "Центра",
    "5376": "Интелком",
    "5408": "SkyNet (Питер)",
    "5418": "Wifire",
    "5462": "2КОМ",
    "5440": "Тарифник",
    "5446": "Ринет",
    "5452": "Уфанет",
    "5972": "Ростелеком МСК (Джаст)",
    "5458": "СитиТелеком (Юрики Питер)",
    "5552": "СитиТелеком (Физики Питер)",
    "5518": "Е-Телеком",
    "5520": "Акадо",
    "5522": "Марьино.нет",
    "5574": "Айзэт (IZET)",
    "5576": "МГТС",
    "5718": "ПАКТ",
    "5720": "Сибирский Медведь",
    "5710": "ъСибСети (Барнаул) - НЕ Выбирать",
    "5706": "ъСибСети (Новосибирск) - НЕ выбирать",
    "5714": "ъСибСети (Красноярск) - НЕ выбирать",
    "5712": "ъСибСети (Кемерово) - НЕ выбирать",
    "5708": "ъСибСети (Новокузнецк) - НЕ выбирать"
}
var CopyArr = {
  "dealId": "",
  "fio": "",
  "City": "",
  "Adress": "",
  "PhoneNumber": "",
  "Provider": "",
  "Tarif": "",
  "OtherInfo": ""
}

var ItemsArr = {
          fio: "null",
          City: "null",
          Adress: "null",
          PhoneNumber: "null",
          Tarif: "null",
          OtherInfo: "null"
      }
//фаундер - функция для поиска заявок
function CardFounder(){
  //Если фаундер не на предохранителе
  if (CardFounder_On) {
    //console.log("Ищу открытую карту")
    //Если открыта карта клиента
    if (window.location.href.indexOf("crm/deal/details") >= 0) {
      //console.log("Нашел открытую карту")
        if (!SiteCard_On) {
          SiteCard_On = true
          console.log("Открыт Site со сделкой");
          setInterval(BackgroundSurvey, 3000)
          SiteCard()
        }
    }
    else{
      //console.log("Карта не найдена")
      SiteCard_On = false
      IframeCard_On = false
    }
  }
}

function BackgroundSurvey(){
  console.log("Запущен опрос бека")
  const iframe = document.getElementsByClassName("side-panel-iframe")[0];
  const iWindow = iframe.contentWindow;
  const iDocument = iWindow.document;

  chrome.runtime.sendMessage({ action: "requestData" }, (response) => {
    if (response && response.data) {
      data = response.data
      console.log("Полученные данные в ходе опроса:", data);
      if (data != 0 && data != null) {
        console.log("Есть что вставить")
        iDocument.querySelector("#Paste_Butt").style.display = 'inline-block' 
      }
      else{
        iDocument.querySelector("#Paste_Butt").style.display = 'none'
      }
    }
    else{
      iDocument.querySelector("#Paste_Butt").style.display = 'none'
    }
  });
}

function SiteCard(){
  if (SiteCard_On) {
    const iframe = document.getElementsByClassName("side-panel-iframe")[0];
    const iWindow = iframe.contentWindow;
    const iDocument = iWindow.document;
    const iframeHead = iDocument.querySelectorAll("head")[0];

    ButtPlace = iDocument.getElementsByClassName("ui-entity-editor-header-title-text")[0]

    if (ButtPlace.innerHTML.indexOf("Скопировать") < 0) {
      iframeHead.innerHTML += "<style>.copy-paste_butt{border-bottom:1px dashed #2067b0;margin-left:10px}.copy-paste_butt:hover{border-bottom:1px dashed #eef2f4; cursor: pointer;}.copy-alert{margin-left: 1%;padding: 0 1% 0 1%;border-radius: 4px;color: white;font-weight: 700;}</style>"
      
      ButtPlace.innerHTML += '<a class="copy-paste_butt" id="Copy_Butt">Скопировать</a><a class="copy-paste_butt" id="Paste_Butt" style="display:none">Вставить</a><span class="copy-alert" id="Successfully_Copied" style="background: #00ab3d; display:none;">Успешно!</span><span class="copy-alert" id="Error_Copied" style="background: #ab0000;display:none;">Ошибка!</span>'

      DealId = window.location.href.split('/').slice(-2)[0];

      iDocument.querySelector("#Copy_Butt").addEventListener("click", e => {
        //Если есть что сохранить - сначала сохраняем
        if (iDocument.getElementsByClassName("ui-entity-wrap crm-section-control-active").length > 0) {
          iDocument.getElementsByClassName("ui-btn-success")[0].click()
          setTimeout(function(){
            GetData_FromREST(iDocument.getElementById("Successfully_Copied"), iDocument.getElementById("Error_Copied"))
          }, 1000); 
        }
        else{
          GetData_FromREST(iDocument.getElementById("Successfully_Copied"), iDocument.getElementById("Error_Copied"))
        }
      });
      iDocument.querySelector("#Paste_Butt").addEventListener("click", e => {
        PasteData()
      });
    }
  }
}

function GetData_FromREST(iSuccess, iError){
  const options = {
    method: 'POST',
    headers: {
    cookie: 'qmb=0.',
      'Content-Type': 'application/json',
      'User-Agent': 'insomnia/8.5.1'
    },
    body: '{"id":"'+DealId+'"}'
  };

  fetch('https://speedinet.bitrix24.ru/rest/26/qzz79qlepr8oxwmk/crm.deal.get', options)
    .then(response => response.json())
    .then(response => {
      console.log(response)
      CopyArr.dealId = DealId
      CopyArr.fio = response.result.UF_CRM_1604651209
      CopyArr.City = cityDecoder[response.result.UF_CRM_1604650869]
      CopyArr.Adress = response.result.UF_CRM_1605781310
      CopyArr.PhoneNumber = response.result.UF_CRM_1604651268
      CopyArr.privider = providerDecoder[response.result.UF_CRM_1604415602]
      CopyArr.Tarif = response.result.UF_CRM_1604651288
      CopyArr.OtherInfo = response.result.UF_CRM_1704275626168
      console.log(CopyArr)
      navigator.clipboard.writeText(JSON.stringify(CopyArr))
        .then(() => {
          console.log('Получилось');

          iSuccess.style.display = 'inline-block'
          setTimeout(function(){iSuccess.style.display = 'none'}, 3000);
        }) 
        .catch(err => {
          console.log('Something went wrong', err);
          iError.style.display = 'inline-block'
          setTimeout(function(){iError.style.display = 'none'}, 3000); 
        });
    })
    .catch(err => {
      console.error(err); 
      iError.style.display = 'inline-block'
      setTimeout(function(){iError.style.display = 'none'}, 3000); 
    });
}

function PasteData(){
  var itogResponse = '{'
  var Oplata = 0

  // Запрос данных у фонового скрипта
  chrome.runtime.sendMessage({ action: "requestData" }, (response) => {
    if (response && response.data) {
      data = response.data
      console.log("Полученные данные:", data);
      if (data.privider == "DomRu") {
        if (data.AbName.length > 0) {
          itogResponse += '"UF_CRM_1604651209": "'+data.AbName+'",'
        }
        if (data.City.length > 0) {
          var key = Object.keys(cityDecoder).find(k => cityDecoder[k] === data.City);
          itogResponse += '"UF_CRM_1604650869": "'+key+'",'
        }
        if (data.Adress != "ул. , д. , кв. ") {
          itogResponse += '"UF_CRM_1605781310": "'+data.Adress+'",'
        }
        if (data.ServicesCount != 0) {
          switch(data.ServicesCount) {
            case 1:
              itogResponse += '"UF_CRM_1669956599": [5558],'
              break;
            case 2:
              itogResponse += '"UF_CRM_1669956599": [5560],'
              break;
            case 3:
              itogResponse += '"UF_CRM_1669956599": [5562],'
              break;
            case 4:
              itogResponse += '"UF_CRM_1669956599": [5564],'
              break;
            case 5:
              itogResponse += '"UF_CRM_1669956599": [5564],'
              break;
            default:
              console.log("Кол-Во услуг не прокинулось");
          }
          
        }
        if (data.Comment != "") {
          itogResponse += '"UF_CRM_1604651288": "'+data.Comment+'",'
        }
        if (data.id != "") {
          itogResponse += '"UF_CRM_1633762539": "'+data.id+'",'
        }
        //Ставим провайдера
        itogResponse += '"UF_CRM_1604415602": "'+86+'",'
        

        // ---- Подсчет оплаты ---- //
        if (data.FullAP != "") {
          //Inet, !CTV, !KTV
          if (data.Services[0] && !data.Services[1] && !data.Services[2]) {
            Oplata += Number(data.FullAP)*1.35 
          }
          //!Inet, CTV, !KTV
          else if (!data.Services[0] && data.Services[1] && !data.Services[2]) {
            Oplata += Number(data.FullAP)*2.2 
          }//!Inet, !CTV, KTV
          else if (!data.Services[0] && !data.Services[1] && data.Services[2]) {
            Oplata += 372
          }
          //Inet + CTV
          else if (data.Services[0] && data.Services[1]) {
            Oplata += Number(data.FullAP)*2.55 
          }
          //Inet + KTV
          else if (data.Services[0] && data.Services[2]) {
            Oplata += Number(data.FullAP)*2.2 
          }
        }
        Oplata += Number(data.RouterCount )*325.5
        Oplata += Number(data.PristavkaCount )*465
        itogResponse += '"OPPORTUNITY": "'+Oplata+'",'
      }
    }
    itogResponse = itogResponse.slice(0, -1) + '}'
    itogResponse = itogResponse.replace(/\n/g, ' ');
    console.log("Итоговый запрос: " + itogResponse + "")
    DealId = window.location.href.split('/').slice(-2)[0]
    const options = {
      method: 'POST',
      headers: {
        cookie: 'qmb=0.',
        'Content-Type': 'application/json',
        'User-Agent': 'insomnia/8.5.1'
      },
      body: '{"id":"'+DealId+'","fields": '+itogResponse+'}'
    };

    fetch('https://speedinet.bitrix24.ru/rest/26/qzz79qlepr8oxwmk/crm.deal.update', options)
      .then(response => response.json())
      .then(response => {
        console.log(response)
        chrome.runtime.sendMessage({ action: "sendData1", data: 0 });
      })
      .catch(err => console.error(err));
  });


}